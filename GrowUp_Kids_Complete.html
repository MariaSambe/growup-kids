<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GrowUp Kids - Plataforma Educativa</title>
    <meta name="author" content="Maria Samb√©">
    <meta name="description" content="Plataforma educativa interativa para crian√ßas dos 5 aos 13 anos">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a3e 50%, #0a0a1a 100%);
            color: #fff;
            min-height: 100vh;
        }
        #particles-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; }
        #app { position: relative; z-index: 1; min-height: 100vh; }
        .glass { background: rgba(255,255,255,0.08); backdrop-filter: blur(20px); border-radius: 20px; border: 1px solid rgba(255,255,255,0.15); box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
        .loading-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at center, #1a1a3e 0%, #0a0a1a 100%); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; transition: opacity 0.5s, visibility 0.5s; }
        .loading-screen.hidden { opacity: 0; visibility: hidden; }
        .loading-spinner { width: 80px; height: 80px; border: 4px solid rgba(255,255,255,0.1); border-top: 4px solid #ff6b9d; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loading-text { margin-top: 20px; font-size: 1.2rem; color: #fff; text-shadow: 0 0 20px rgba(255,107,157,0.5); }
        .screen { display: none; min-height: 100vh; padding: 20px; }
        .screen.active { display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .welcome-logo { font-size: 5rem; margin-bottom: 20px; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-15px); } }
        .welcome-title { font-size: 3.5rem; font-weight: bold; background: linear-gradient(45deg, #ff6b9d, #c06bf8, #4ecdc4, #f7971e); background-size: 300% 300%; -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; animation: gradient 5s ease infinite; margin-bottom: 10px; text-align: center; }
        @keyframes gradient { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
        .welcome-subtitle { font-size: 1.3rem; color: #aaa; margin-bottom: 50px; text-align: center; }
        .welcome-buttons { display: flex; gap: 20px; flex-wrap: wrap; justify-content: center; }
        .btn { padding: 18px 45px; font-size: 1.2rem; font-weight: bold; border: none; border-radius: 50px; cursor: pointer; transition: all 0.3s; text-decoration: none; display: inline-flex; align-items: center; gap: 10px; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; box-shadow: 0 10px 30px rgba(102,126,234,0.4); }
        .btn-primary:hover { transform: translateY(-5px) scale(1.05); box-shadow: 0 15px 40px rgba(102,126,234,0.6); }
        .btn-secondary { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; box-shadow: 0 10px 30px rgba(240,147,251,0.4); }
        .btn-secondary:hover { transform: translateY(-5px) scale(1.05); box-shadow: 0 15px 40px rgba(240,147,251,0.6); }
        .btn-back { padding: 15px 30px; font-size: 1rem; border: 2px solid rgba(255,255,255,0.3); border-radius: 12px; background: transparent; color: #fff; cursor: pointer; transition: all 0.3s; }
        .btn-back:hover { border-color: #ff6b9d; background: rgba(255,107,157,0.1); }
        .form-container { max-width: 600px; width: 100%; padding: 40px; }
        .form-title { font-size: 2.2rem; margin-bottom: 10px; text-align: center; background: linear-gradient(45deg, #ff6b9d, #c06bf8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .form-subtitle { text-align: center; color: #aaa; margin-bottom: 30px; }
        .form-group { margin-bottom: 25px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 600; color: #fff; }
        .form-input, .form-select { width: 100%; padding: 15px; font-size: 1.1rem; border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; background: rgba(255,255,255,0.05); color: #fff; transition: all 0.3s; }
        .form-input:focus, .form-select:focus { outline: none; border-color: #ff6b9d; background: rgba(255,255,255,0.1); box-shadow: 0 0 20px rgba(255,107,157,0.3); }
        .form-select option { background: #1a1a3e; color: #fff; }
        .form-error { color: #ff6b9d; font-size: 0.9rem; margin-top: 5px; }
        .avatar-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 10px; }
        .avatar-option { padding: 20px 10px; text-align: center; border-radius: 15px; cursor: pointer; transition: all 0.3s; border: 3px solid transparent; background: rgba(255,255,255,0.05); }
        .avatar-option:hover { transform: scale(1.05); border-color: rgba(255,107,157,0.5); }
        .avatar-option.selected { border-color: #ff6b9d; background: rgba(255,107,157,0.2); box-shadow: 0 0 30px rgba(255,107,157,0.5); }
        .avatar-emoji { font-size: 2.5rem; margin-bottom: 5px; }
        .avatar-name { font-size: 0.85rem; color: #ddd; }
        .pin-container { display: flex; gap: 10px; justify-content: center; margin-top: 10px; }
        .pin-digit { width: 55px; height: 55px; font-size: 1.8rem; text-align: center; border: 2px solid rgba(255,255,255,0.2); border-radius: 12px; background: rgba(255,255,255,0.05); color: #fff; }
        .pin-digit:focus { outline: none; border-color: #ff6b9d; box-shadow: 0 0 20px rgba(255,107,157,0.5); }
        .profiles-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; margin: 30px 0; width: 100%; max-width: 800px; }
        .profile-card { padding: 25px; text-align: center; border-radius: 20px; cursor: pointer; transition: all 0.3s; border: 3px solid transparent; }
        .profile-card:hover { transform: translateY(-10px) scale(1.03); border-color: #ff6b9d; box-shadow: 0 20px 40px rgba(255,107,157,0.3); }
        .profile-avatar { font-size: 3.5rem; margin-bottom: 10px; }
        .profile-name { font-size: 1.2rem; font-weight: bold; margin-bottom: 5px; }
        .profile-age { font-size: 0.9rem; color: #aaa; }
        .add-profile { border: 3px dashed rgba(255,255,255,0.3); display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .add-profile-icon { font-size: 3rem; opacity: 0.5; }
        .pin-entry-avatar { font-size: 5rem; margin-bottom: 15px; }
        .pin-entry-name { font-size: 2rem; margin-bottom: 30px; }
        .pin-display { display: flex; gap: 15px; justify-content: center; margin-bottom: 30px; }
        .pin-dot { width: 18px; height: 18px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.3); transition: all 0.3s; }
        .pin-dot.filled { background: #ff6b9d; border-color: #ff6b9d; box-shadow: 0 0 15px rgba(255,107,157,0.8); }
        .pin-keyboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; max-width: 280px; }
        .pin-key { width: 70px; height: 70px; font-size: 1.8rem; font-weight: bold; border: none; border-radius: 50%; background: rgba(255,255,255,0.1); color: #fff; cursor: pointer; transition: all 0.2s; }
        .pin-key:hover { background: rgba(255,255,255,0.2); transform: scale(1.1); }
        .pin-key:active { transform: scale(0.95); }
        .dashboard { display: flex; min-height: 100vh; width: 100%; }
        .sidebar { width: 280px; padding: 20px; background: rgba(0,0,0,0.3); backdrop-filter: blur(20px); border-right: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; }
        .sidebar-profile { text-align: center; padding: 20px 0; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; }
        .sidebar-avatar { font-size: 4rem; margin-bottom: 10px; }
        .sidebar-name { font-size: 1.3rem; font-weight: bold; }
        .sidebar-level { font-size: 0.9rem; color: #aaa; margin-top: 5px; }
        .sidebar-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 20px 0; }
        .stat-item { text-align: center; padding: 15px 10px; border-radius: 12px; background: rgba(255,255,255,0.05); }
        .stat-icon { font-size: 1.5rem; }
        .stat-value { font-size: 1.3rem; font-weight: bold; margin: 5px 0; }
        .stat-label { font-size: 0.75rem; color: #aaa; }
        .xp-bar { margin: 15px 0; }
        .xp-bar-label { display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 5px; }
        .xp-bar-track { height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden; }
        .xp-bar-fill { height: 100%; background: linear-gradient(90deg, #ff6b9d, #c06bf8); border-radius: 4px; transition: width 0.5s; }
        .sidebar-nav { flex: 1; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 15px; border-radius: 12px; cursor: pointer; transition: all 0.3s; margin-bottom: 8px; font-size: 1rem; }
        .nav-item:hover { background: rgba(255,255,255,0.1); }
        .nav-item.active { background: linear-gradient(135deg, rgba(102,126,234,0.3), rgba(118,75,162,0.3)); border: 1px solid rgba(102,126,234,0.5); }
        .nav-item.locked { opacity: 0.5; cursor: not-allowed; }
        .nav-icon { font-size: 1.3rem; }
        .nav-badge { margin-left: auto; padding: 2px 8px; border-radius: 10px; font-size: 0.75rem; background: #ff6b9d; }
        .sidebar-logout { padding: 15px; text-align: center; border-top: 1px solid rgba(255,255,255,0.1); margin-top: auto; }
        .logout-btn { width: 100%; padding: 12px; border: 2px solid rgba(255,107,157,0.5); border-radius: 12px; background: transparent; color: #ff6b9d; font-size: 1rem; cursor: pointer; transition: all 0.3s; }
        .logout-btn:hover { background: rgba(255,107,157,0.2); }
        .main-content { flex: 1; padding: 30px; overflow-y: auto; }
        .content-header { margin-bottom: 30px; }
        .content-title { font-size: 2rem; margin-bottom: 5px; }
        .content-subtitle { color: #aaa; }
        .plant-widget { padding: 30px; text-align: center; margin-bottom: 30px; }
        .plant-emoji { font-size: 5rem; margin-bottom: 15px; animation: float 3s ease-in-out infinite; }
        .plant-name { font-size: 1.3rem; font-weight: bold; margin-bottom: 5px; }
        .plant-stage { color: #aaa; font-size: 0.9rem; }
        .lessons-section { margin-bottom: 40px; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px; }
        .section-title { font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
        .filter-tabs { display: flex; gap: 10px; flex-wrap: wrap; }
        .filter-tab { padding: 8px 20px; border-radius: 20px; border: none; background: rgba(255,255,255,0.1); color: #fff; cursor: pointer; transition: all 0.3s; font-size: 0.9rem; }
        .filter-tab:hover { background: rgba(255,255,255,0.2); }
        .filter-tab.active { background: linear-gradient(135deg, #667eea, #764ba2); }
        .lessons-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .lesson-card { padding: 25px; border-radius: 16px; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden; }
        .lesson-card:hover { transform: translateY(-5px); box-shadow: 0 15px 40px rgba(0,0,0,0.3); }
        .lesson-card.completed { border: 2px solid #4ecdc4; }
        .lesson-card.locked { opacity: 0.6; cursor: not-allowed; }
        .lesson-icon { font-size: 2.5rem; margin-bottom: 15px; }
        .lesson-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 8px; }
        .lesson-category { font-size: 0.85rem; color: #aaa; margin-bottom: 10px; }
        .lesson-progress { display: flex; align-items: center; gap: 8px; font-size: 0.85rem; }
        .lesson-badge { position: absolute; top: 15px; right: 15px; font-size: 1.2rem; }
        .quiz-container { max-width: 700px; margin: 0 auto; padding: 40px; }
        .quiz-progress { margin-bottom: 30px; }
        .quiz-progress-text { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.9rem; }
        .quiz-progress-bar { height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; }
        .quiz-progress-fill { height: 100%; background: linear-gradient(90deg, #4ecdc4, #44a08d); transition: width 0.3s; }
        .quiz-question { font-size: 1.5rem; margin-bottom: 30px; text-align: center; line-height: 1.5; }
        .quiz-options { display: flex; flex-direction: column; gap: 15px; }
        .quiz-option { padding: 20px; border-radius: 12px; border: 2px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); cursor: pointer; transition: all 0.3s; font-size: 1.1rem; text-align: left; }
        .quiz-option:hover { border-color: rgba(255,255,255,0.4); background: rgba(255,255,255,0.1); }
        .quiz-option.correct { border-color: #4ecdc4; background: rgba(78,205,196,0.2); }
        .quiz-option.incorrect { border-color: #ff6b9d; background: rgba(255,107,157,0.2); }
        .quiz-feedback { text-align: center; padding: 20px; margin-top: 20px; border-radius: 12px; font-size: 1.2rem; }
        .quiz-feedback.correct { background: rgba(78,205,196,0.2); color: #4ecdc4; }
        .quiz-feedback.incorrect { background: rgba(255,107,157,0.2); color: #ff6b9d; }
        .quiz-next-btn { display: block; width: 100%; margin-top: 20px; padding: 18px; font-size: 1.1rem; }
        .completion-screen { text-align: center; padding: 50px; }
        .completion-emoji { font-size: 6rem; margin-bottom: 20px; animation: bounce 1s ease infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        .completion-title { font-size: 2.5rem; margin-bottom: 20px; background: linear-gradient(45deg, #4ecdc4, #44a08d); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .completion-rewards { display: flex; justify-content: center; gap: 40px; margin: 30px 0; }
        .reward-item { text-align: center; }
        .reward-icon { font-size: 2.5rem; margin-bottom: 5px; }
        .reward-value { font-size: 1.5rem; font-weight: bold; }
        .challenges-grid, .tasks-grid { display: flex; flex-direction: column; gap: 15px; }
        .challenge-card, .task-card { display: flex; align-items: center; gap: 20px; padding: 20px; border-radius: 12px; transition: all 0.3s; }
        .challenge-card.locked { opacity: 0.5; }
        .challenge-checkbox, .task-checkbox { width: 28px; height: 28px; border-radius: 8px; border: 2px solid rgba(255,255,255,0.3); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1rem; transition: all 0.3s; flex-shrink: 0; }
        .challenge-checkbox.checked, .task-checkbox.checked { background: #4ecdc4; border-color: #4ecdc4; }
        .challenge-checkbox.locked { cursor: not-allowed; background: rgba(255,255,255,0.1); }
        .challenge-info, .task-info { flex: 1; }
        .challenge-title, .task-title { font-weight: bold; margin-bottom: 3px; }
        .challenge-desc, .task-desc { font-size: 0.85rem; color: #aaa; }
        .challenge-reward, .task-reward { font-weight: bold; color: #ffd700; flex-shrink: 0; }
        .unlock-message { text-align: center; padding: 30px; color: #aaa; }
        .unlock-progress { margin-top: 15px; }
        .unlock-bar { height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden; margin-top: 10px; }
        .unlock-fill { height: 100%; background: linear-gradient(90deg, #ff6b9d, #c06bf8); transition: width 0.5s; }
        .app-footer { padding: 40px 20px; text-align: center; border-top: 1px solid rgba(255,255,255,0.1); margin-top: 60px; background: rgba(0,0,0,0.3); }
        .footer-logo { font-size: 1.8rem; margin-bottom: 15px; }
        .footer-info { font-size: 0.9rem; color: #888; margin-bottom: 20px; }
        .footer-credits { margin-bottom: 10px; }
        .footer-credits strong { color: #ff6b9d; font-size: 1.1rem; }
        .footer-copyright { font-size: 0.85rem; color: #666; }
        .footer-links { display: flex; gap: 25px; justify-content: center; margin-top: 20px; flex-wrap: wrap; }
        .footer-link { color: #888; text-decoration: none; transition: color 0.3s; font-size: 0.9rem; }
        .footer-link:hover { color: #ff6b9d; }
        @media (max-width: 900px) {
            .dashboard { flex-direction: column; }
            .sidebar { width: 100%; border-right: none; border-bottom: 1px solid rgba(255,255,255,0.1); }
            .sidebar-stats { grid-template-columns: repeat(4, 1fr); }
            .sidebar-nav { display: flex; flex-wrap: wrap; gap: 10px; }
            .nav-item { flex: 1; min-width: 120px; justify-content: center; }
        }
        @media (max-width: 600px) {
            .welcome-title { font-size: 2.2rem; }
            .avatar-grid { grid-template-columns: repeat(2, 1fr); }
            .profiles-grid { grid-template-columns: repeat(2, 1fr); }
            .lessons-grid { grid-template-columns: 1fr; }
            .sidebar-stats { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <canvas id="particles-canvas"></canvas>
    <div id="app">
        <div id="loading-screen" class="loading-screen">
            <div class="loading-spinner"></div>
            <div class="loading-text">‚ú® Preparando experi√™ncia c√≥smica...</div>
        </div>
    </div>

    <script>
        // GrowUp Kids - Plataforma Educativa
        // Desenvolvido por Maria Samb√©
        // ¬© 2025 - Todos os direitos reservados

        const AVATARS = [
            { id: 'sofia', emoji: 'üëßüéÄ', name: 'Sofia G√©nio' },
            { id: 'luna', emoji: 'üëßüåô', name: 'Luna S√°bia' },
            { id: 'iris', emoji: 'üëßüëì', name: 'Iris Inteligente' },
            { id: 'pedro', emoji: 'üë¶üé©', name: 'Pedro S√°bio' },
            { id: 'marco', emoji: 'üë¶‚≠ê', name: 'Marco Esperto' },
            { id: 'tomas', emoji: 'üë¶üí°', name: 'Tom√°s Brilhante' }
        ];

        const PLANT_STAGES = [
            { name: 'Semente', emoji: 'üå±', minLessons: 0 },
            { name: 'Broto', emoji: 'üåø', minLessons: 3 },
            { name: 'Pequena Planta', emoji: 'ü™¥', minLessons: 6 },
            { name: 'Planta M√©dia', emoji: 'üå≥', minLessons: 10 },
            { name: '√Årvore Florida', emoji: 'üå∏', minLessons: 15 },
            { name: '√Årvore Frut√≠fera', emoji: 'üçé', minLessons: 20 },
            { name: '√Årvore M√°gica', emoji: '‚ú®üå≥‚ú®', minLessons: 30 },
            { name: '√Årvore C√≥smica', emoji: 'üååüå≥üåå', minLessons: 40 }
        ];

        const FINANCIAL_LESSONS = [
            { id: 'fin1', title: 'O que √© dinheiro?', icon: 'üí∞', category: 'Literacia Financeira', questions: [
                { q: 'Para que serve o dinheiro?', options: ['Comprar coisas', 'Brincar', 'Dormir', 'Correr'], correct: 0 },
                { q: 'Onde podemos guardar dinheiro?', options: ['Na cama', 'No mealheiro', 'Na janela', 'No ch√£o'], correct: 1 },
                { q: 'O que √© poupar?', options: ['Gastar tudo', 'Guardar para depois', 'Perder', 'Dar'], correct: 1 }
            ]},
            { id: 'fin2', title: 'Poupar √© importante', icon: 'üê∑', category: 'Literacia Financeira', questions: [
                { q: 'Porque devemos poupar?', options: ['Para ter dinheiro no futuro', 'Para gastar tudo', 'Para perder', 'Para nada'], correct: 0 },
                { q: 'Onde √© bom guardar poupan√ßas?', options: ['Debaixo da cama', 'Num mealheiro ou banco', 'No lixo', 'Na rua'], correct: 1 },
                { q: 'Se tens 10‚Ç¨ e poupas 5‚Ç¨, quanto gastas?', options: ['10‚Ç¨', '5‚Ç¨', '15‚Ç¨', '0‚Ç¨'], correct: 1 }
            ]},
            { id: 'fin3', title: 'Necessidades vs Desejos', icon: 'üéØ', category: 'Literacia Financeira', questions: [
                { q: 'O que √© uma necessidade?', options: ['Brinquedo novo', 'Comida', 'Videojogo', 'Doces'], correct: 1 },
                { q: 'O que √© um desejo?', options: ['√Ågua', 'Casa', 'Brinquedo', 'Roupa'], correct: 2 },
                { q: 'O que devemos comprar primeiro?', options: ['Desejos', 'Necessidades', 'Tudo', 'Nada'], correct: 1 }
            ]},
            { id: 'fin4', title: 'Como ganhar dinheiro', icon: 'üíº', category: 'Literacia Financeira', questions: [
                { q: 'Como os adultos ganham dinheiro?', options: ['Dormindo', 'Trabalhando', 'Brincando', 'Comendo'], correct: 1 },
                { q: 'Uma crian√ßa pode ganhar dinheiro como?', options: ['Ajudando em casa', 'N√£o fazendo nada', 'Dormindo', 'Chorando'], correct: 0 },
                { q: 'O que √© uma mesada?', options: ['Um brinquedo', 'Dinheiro dado regularmente', 'Uma comida', 'Um jogo'], correct: 1 }
            ]},
            { id: 'fin5', title: 'O valor das coisas', icon: 'üè∑Ô∏è', category: 'Literacia Financeira', questions: [
                { q: 'Porque algumas coisas custam mais?', options: ['S√£o mais dif√≠ceis de fazer', 'S√£o feias', 'S√£o pequenas', 'S√£o velhas'], correct: 0 },
                { q: 'O que significa "caro"?', options: ['Custa pouco', 'Custa muito', '√â gr√°tis', '√â feio'], correct: 1 },
                { q: 'Devemos comparar pre√ßos antes de comprar?', options: ['N√£o', 'Sim', 'Nunca', 'Talvez n√£o'], correct: 1 }
            ]}
        ];

        const SOCIAL_LESSONS = [
            { id: 'soc1', title: 'Respeitar os outros', icon: 'ü§ù', category: 'Conviv√™ncia', questions: [
                { q: 'O que significa respeitar?', options: ['Ignorar', 'Tratar bem', 'Gritar', 'Empurrar'], correct: 1 },
                { q: 'Como devemos falar com os mais velhos?', options: ['Gritando', 'Com educa√ß√£o', 'Ignorando', 'Rindo'], correct: 1 },
                { q: 'O que dizemos quando pedimos algo?', options: ['D√°-me!', 'Por favor', 'Agora!', 'Quero!'], correct: 1 }
            ]},
            { id: 'soc2', title: 'Partilhar √© bom', icon: 'üéÅ', category: 'Conviv√™ncia', questions: [
                { q: 'Porque devemos partilhar?', options: ['Para ficar triste', 'Para fazer amigos felizes', 'Para perder coisas', 'N√£o devemos'], correct: 1 },
                { q: 'O que podemos partilhar?', options: ['Brinquedos', 'Doen√ßas', 'Problemas', 'Tristeza'], correct: 0 },
                { q: 'Como te sentes quando partilhas?', options: ['Triste', 'Zangado', 'Feliz', 'Assustado'], correct: 2 }
            ]},
            { id: 'soc3', title: 'Dizer a verdade', icon: '‚ú®', category: 'Conviv√™ncia', questions: [
                { q: 'Porque √© importante dizer a verdade?', options: ['N√£o √© importante', 'Para as pessoas confiarem em n√≥s', 'Para ter problemas', 'Para nada'], correct: 1 },
                { q: 'O que acontece quando mentimos?', options: ['Ficamos felizes', 'Perdemos a confian√ßa dos outros', 'Ganhamos pr√©mios', 'Nada'], correct: 1 },
                { q: 'Se fizeres algo errado, deves...', options: ['Mentir', 'Esconder', 'Admitir e pedir desculpa', 'Culpar outro'], correct: 2 }
            ]},
            { id: 'soc4', title: 'Ajudar os outros', icon: 'üí™', category: 'Conviv√™ncia', questions: [
                { q: 'Quando devemos ajudar?', options: ['Nunca', 'Quando algu√©m precisa', 'S√≥ aos domingos', 'S√≥ se pagarem'], correct: 1 },
                { q: 'Como podemos ajudar em casa?', options: ['Fazendo bagun√ßa', 'Arrumando o quarto', 'Gritando', 'Dormindo'], correct: 1 },
                { q: 'Ajudar os outros nos faz sentir...', options: ['Tristes', 'Zangados', 'Bem', 'Cansados'], correct: 2 }
            ]},
            { id: 'soc5', title: 'Ser gentil', icon: 'üíù', category: 'Conviv√™ncia', questions: [
                { q: 'O que √© ser gentil?', options: ['Ser mau', 'Ser simp√°tico e am√°vel', 'Ser ego√≠sta', 'Ser pregui√ßoso'], correct: 1 },
                { q: 'Uma palavra gentil √©...', options: ['Vai embora!', 'Obrigado!', 'N√£o quero!', 'Sai!'], correct: 1 },
                { q: 'Ser gentil faz os outros sentirem-se...', options: ['Mal', 'Bem', 'Tristes', 'Zangados'], correct: 1 }
            ]}
        ];

        const PORTUGUESE_LESSONS = [
            { id: 'pt1', title: 'O Alfabeto', icon: 'üî§', category: 'Portugu√™s', questions: [
                { q: 'Quantas letras tem o alfabeto portugu√™s?', options: ['20', '26', '30', '24'], correct: 1 },
                { q: 'Qual √© a primeira letra do alfabeto?', options: ['B', 'Z', 'A', 'C'], correct: 2 },
                { q: 'Qual √© a √∫ltima letra do alfabeto?', options: ['X', 'Y', 'W', 'Z'], correct: 3 }
            ]},
            { id: 'pt2', title: 'Vogais e Consoantes', icon: 'üìù', category: 'Portugu√™s', questions: [
                { q: 'Quantas vogais existem?', options: ['3', '5', '7', '10'], correct: 1 },
                { q: 'Qual destas √© uma vogal?', options: ['B', 'C', 'E', 'D'], correct: 2 },
                { q: 'A letra "M" √© uma...', options: ['Vogal', 'Consoante', 'N√∫mero', 'S√≠mbolo'], correct: 1 }
            ]},
            { id: 'pt3', title: 'S√≠labas Simples', icon: 'üìñ', category: 'Portugu√™s', questions: [
                { q: 'Quantas s√≠labas tem "BOLA"?', options: ['1', '2', '3', '4'], correct: 1 },
                { q: 'Como se separa "CASA"?', options: ['C-ASA', 'CA-SA', 'CAS-A', 'CASA'], correct: 1 },
                { q: 'Qual palavra tem 3 s√≠labas?', options: ['Sol', 'Casa', 'Banana', 'P√©'], correct: 2 }
            ]},
            { id: 'pt4', title: 'Palavras Simples', icon: '‚úèÔ∏è', category: 'Portugu√™s', questions: [
                { q: 'Como se escreve o animal que ladra?', options: ['GAO', 'C√ÉO', 'CAU', 'K√ÉO'], correct: 1 },
                { q: 'Qual palavra est√° correta?', options: ['KASA', 'CAZA', 'CASA', 'KAZA'], correct: 2 },
                { q: 'Como se escreve o animal que mia?', options: ['GATU', 'CATO', 'GATO', 'KATO'], correct: 2 }
            ]},
            { id: 'pt5', title: 'Frases Simples', icon: 'üìÑ', category: 'Portugu√™s', questions: [
                { q: 'Como deve come√ßar uma frase?', options: ['Com letra min√∫scula', 'Com letra mai√∫scula', 'Com n√∫mero', 'Com ponto'], correct: 1 },
                { q: 'Como termina uma frase?', options: ['Com v√≠rgula', 'Com letra', 'Com ponto', 'Com espa√ßo'], correct: 2 },
                { q: 'Qual frase est√° correta?', options: ['o gato √© bonito', 'O gato √© bonito.', 'O Gato √© Bonito', 'o Gato √© bonito.'], correct: 1 }
            ]}
        ];

        const MATH_LESSONS = [
            { id: 'mat1', title: 'N√∫meros 1 a 10', icon: 'üî¢', category: 'Matem√°tica', questions: [
                { q: 'Qual n√∫mero vem depois do 5?', options: ['4', '6', '7', '3'], correct: 1 },
                { q: 'Qual n√∫mero vem antes do 8?', options: ['9', '6', '7', '10'], correct: 2 },
                { q: 'Quantos dedos tens numa m√£o?', options: ['4', '6', '5', '10'], correct: 2 }
            ]},
            { id: 'mat2', title: 'Adi√ß√£o Simples', icon: '‚ûï', category: 'Matem√°tica', questions: [
                { q: 'Quanto √© 2 + 3?', options: ['4', '5', '6', '7'], correct: 1 },
                { q: 'Quanto √© 4 + 4?', options: ['6', '7', '8', '9'], correct: 2 },
                { q: 'Quanto √© 1 + 9?', options: ['8', '9', '10', '11'], correct: 2 }
            ]},
            { id: 'mat3', title: 'Subtra√ß√£o Simples', icon: '‚ûñ', category: 'Matem√°tica', questions: [
                { q: 'Quanto √© 5 - 2?', options: ['2', '3', '4', '7'], correct: 1 },
                { q: 'Quanto √© 10 - 5?', options: ['4', '5', '6', '15'], correct: 1 },
                { q: 'Quanto √© 8 - 3?', options: ['4', '5', '6', '11'], correct: 1 }
            ]},
            { id: 'mat4', title: 'Formas Geom√©tricas', icon: 'üî∑', category: 'Matem√°tica', questions: [
                { q: 'Quantos lados tem um quadrado?', options: ['3', '4', '5', '6'], correct: 1 },
                { q: 'Quantos lados tem um tri√¢ngulo?', options: ['3', '4', '5', '2'], correct: 0 },
                { q: 'Um c√≠rculo tem quantos cantos?', options: ['1', '2', '4', '0'], correct: 3 }
            ]},
            { id: 'mat5', title: 'Maior e Menor', icon: '‚öñÔ∏è', category: 'Matem√°tica', questions: [
                { q: 'Qual n√∫mero √© maior: 7 ou 3?', options: ['3', '7', 'S√£o iguais', 'Nenhum'], correct: 1 },
                { q: 'Qual n√∫mero √© menor: 9 ou 5?', options: ['9', '5', 'S√£o iguais', 'Nenhum'], correct: 1 },
                { q: '8 √© maior que 10?', options: ['Sim', 'N√£o', 'S√£o iguais', 'Talvez'], correct: 1 }
            ]}
        ];

        const SCIENCE_LESSONS = [
            { id: 'sci1', title: 'Os Cinco Sentidos', icon: 'üëÅÔ∏è', category: 'Ci√™ncias', questions: [
                { q: 'Com que sentido vemos?', options: ['Olfato', 'Vis√£o', 'Audi√ß√£o', 'Tato'], correct: 1 },
                { q: 'Com que sentido ouvimos?', options: ['Vis√£o', 'Paladar', 'Audi√ß√£o', 'Olfato'], correct: 2 },
                { q: 'Quantos sentidos temos?', options: ['3', '4', '5', '6'], correct: 2 }
            ]},
            { id: 'sci2', title: 'Animais Dom√©sticos', icon: 'üêï', category: 'Ci√™ncias', questions: [
                { q: 'Qual animal √© dom√©stico?', options: ['Le√£o', 'C√£o', 'Elefante', 'Tigre'], correct: 1 },
                { q: 'O que come um gato?', options: ['Capim', 'Ra√ß√£o', 'Pedras', 'Papel'], correct: 1 },
                { q: 'Onde vive um peixe dom√©stico?', options: ['Na terra', 'No aqu√°rio', 'No ar', 'Na √°rvore'], correct: 1 }
            ]},
            { id: 'sci3', title: 'As Plantas', icon: 'üå±', category: 'Ci√™ncias', questions: [
                { q: 'O que as plantas precisam para viver?', options: ['S√≥ √°gua', '√Ågua, luz e terra', 'S√≥ luz', 'Nada'], correct: 1 },
                { q: 'Por onde a planta bebe √°gua?', options: ['Folhas', 'Flores', 'Ra√≠zes', 'Tronco'], correct: 2 },
                { q: 'O que as plantas produzem?', options: ['Polui√ß√£o', 'Oxig√©nio', 'Fumo', 'Lixo'], correct: 1 }
            ]},
            { id: 'sci4', title: 'O Corpo Humano', icon: 'ü´Ä', category: 'Ci√™ncias', questions: [
                { q: 'Qual √≥rg√£o bombeia sangue?', options: ['Pulm√£o', 'Cora√ß√£o', 'Est√¥mago', 'C√©rebro'], correct: 1 },
                { q: 'Com que √≥rg√£o pensamos?', options: ['Cora√ß√£o', 'Pulm√£o', 'C√©rebro', 'Est√¥mago'], correct: 2 },
                { q: 'Quantos ossos tem um adulto?', options: ['100', '150', '206', '300'], correct: 2 }
            ]},
            { id: 'sci5', title: 'A √Ågua', icon: 'üíß', category: 'Ci√™ncias', questions: [
                { q: 'Quais s√£o os estados da √°gua?', options: ['S√≥ l√≠quido', 'L√≠quido, s√≥lido e gasoso', 'S√≥ gasoso', 'S√≥ s√≥lido'], correct: 1 },
                { q: 'O gelo √© √°gua em que estado?', options: ['L√≠quido', 'Gasoso', 'S√≥lido', 'Plasma'], correct: 2 },
                { q: 'Devemos poupar √°gua?', options: ['N√£o', 'Sim', 'Tanto faz', 'Nunca'], correct: 1 }
            ]}
        ];

        const CHALLENGES = [
            { id: 'ch1', title: 'Poupar 5 moedas', desc: 'Guarda 5 moedas sem gastar', reward: 50, icon: 'ü™ô' },
            { id: 'ch2', title: 'Completar 5 li√ß√µes', desc: 'Termina 5 li√ß√µes diferentes', reward: 100, icon: 'üìö' },
            { id: 'ch3', title: 'Ser gentil 7 dias', desc: 'Pratica gentileza todos os dias', reward: 70, icon: 'üíù' },
            { id: 'ch4', title: 'Ajudar em casa', desc: 'Ajuda nas tarefas dom√©sticas', reward: 60, icon: 'üè†' },
            { id: 'ch5', title: 'Ler um livro', desc: 'L√™ um livro inteiro', reward: 80, icon: 'üìñ' },
            { id: 'ch6', title: 'Fazer exerc√≠cio', desc: 'Pratica desporto 5 vezes', reward: 75, icon: '‚öΩ' },
            { id: 'ch7', title: 'Aprender algo novo', desc: 'Descobre um facto novo', reward: 50, icon: 'üß†' },
            { id: 'ch8', title: 'Partilhar com amigo', desc: 'Partilha algo com um amigo', reward: 40, icon: 'ü§ù' }
        ];

        const TASKS = [
            { id: 't1', title: 'Arrumar o quarto', reward: 10, icon: 'üõèÔ∏è' },
            { id: 't2', title: 'Fazer a cama', reward: 5, icon: 'üõå' },
            { id: 't3', title: 'Lavar a loi√ßa', reward: 15, icon: 'üçΩÔ∏è' },
            { id: 't4', title: 'Varrer o ch√£o', reward: 15, icon: 'üßπ' },
            { id: 't5', title: 'Regar as plantas', reward: 10, icon: 'üå±' },
            { id: 't6', title: 'P√¥r a mesa', reward: 10, icon: 'üç¥' },
            { id: 't7', title: 'Ajudar a cozinhar', reward: 20, icon: 'üë®‚Äçüç≥' },
            { id: 't8', title: 'Organizar brinquedos', reward: 10, icon: 'üß∏' },
            { id: 't9', title: 'Dar comida ao animal', reward: 10, icon: 'üêï' }
        ];

        const ALL_LESSONS = [...FINANCIAL_LESSONS, ...SOCIAL_LESSONS, ...PORTUGUESE_LESSONS, ...MATH_LESSONS, ...SCIENCE_LESSONS];

        let state = { screen: 'welcome', profiles: [], currentProfile: null, selectedProfile: null, currentLesson: null, currentQuestion: 0, quizScore: 0, activeTab: 'dashboard', lessonFilter: 'all' };
        let selectedAvatarId = null;
        let enteredPin = '';

        function generateId() { return 'id_' + Math.random().toString(36).substr(2, 9); }
        function encryptPIN(pin) { return btoa(pin); }
        function decryptPIN(encrypted) { try { return atob(encrypted); } catch { return null; } }
        function saveProfiles() { localStorage.setItem('growupkids_profiles', JSON.stringify(state.profiles)); }
        function loadProfiles() { const data = localStorage.getItem('growupkids_profiles'); state.profiles = data ? JSON.parse(data) : []; }
        function saveCurrentSession(profileId) { localStorage.setItem('growupkids_session', profileId); }
        function loadCurrentSession() { return localStorage.getItem('growupkids_session'); }
        function clearSession() { localStorage.removeItem('growupkids_session'); }
        function getAvatar(avatarId) { return AVATARS.find(a => a.id === avatarId) || AVATARS[0]; }
        function getPlantStage(lessonsCompleted) { for (let i = PLANT_STAGES.length - 1; i >= 0; i--) { if (lessonsCompleted >= PLANT_STAGES[i].minLessons) return PLANT_STAGES[i]; } return PLANT_STAGES[0]; }
        function calculateLevel(xp) { return Math.floor(xp / 100) + 1; }
        function triggerConfetti() { confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } }); }

        function render() {
            const app = document.getElementById('app');
            let html = '';
            switch (state.screen) {
                case 'welcome': html = renderWelcome(); break;
                case 'register': html = renderRegister(); break;
                case 'login': html = renderLogin(); break;
                case 'pinEntry': html = renderPinEntry(); break;
                case 'dashboard': html = renderDashboard(); break;
                case 'quiz': html = renderQuiz(); break;
                case 'completion': html = renderCompletion(); break;
            }
            app.innerHTML = html;
        }

        function renderWelcome() {
            return `<div class="screen active"><div class="welcome-logo">üåå</div><h1 class="welcome-title">GrowUp Kids</h1><p class="welcome-subtitle">Plataforma Educativa Interativa<br>Para crian√ßas dos 5 aos 13 anos</p><div class="welcome-buttons"><button class="btn btn-primary" onclick="goToScreen('register')">üöÄ Criar Conta</button><button class="btn btn-secondary" onclick="goToScreen('login')">üîë J√° tenho conta</button></div></div>${renderFooter()}`;
        }

        function renderRegister() {
            return `<div class="screen active"><div class="form-container glass"><h2 class="form-title">Criar Nova Conta</h2><p class="form-subtitle">Preenche os teus dados</p><div class="form-group"><label class="form-label">Nome da Crian√ßa</label><input type="text" id="reg-name" class="form-input" placeholder="Ex: Sofia" maxlength="20"><div id="name-error" class="form-error" style="display:none;"></div></div><div class="form-group"><label class="form-label">Idade</label><select id="reg-age" class="form-select"><option value="">Seleciona a idade</option>${[5,6,7,8,9,10,11,12,13].map(a => `<option value="${a}">${a} anos</option>`).join('')}</select><div id="age-error" class="form-error" style="display:none;"></div></div><div class="form-group"><label class="form-label">Escolhe o teu Avatar</label><div class="avatar-grid">${AVATARS.map(a => `<div class="avatar-option" data-avatar="${a.id}" onclick="selectAvatar('${a.id}')"><div class="avatar-emoji">${a.emoji}</div><div class="avatar-name">${a.name}</div></div>`).join('')}</div><div id="avatar-error" class="form-error" style="display:none;"></div></div><div class="form-group"><label class="form-label">Cria um PIN de 4 d√≠gitos</label><div class="pin-container"><input type="password" class="pin-digit" maxlength="1" data-pin="0" oninput="handlePinInput(this, 0)"><input type="password" class="pin-digit" maxlength="1" data-pin="1" oninput="handlePinInput(this, 1)"><input type="password" class="pin-digit" maxlength="1" data-pin="2" oninput="handlePinInput(this, 2)"><input type="password" class="pin-digit" maxlength="1" data-pin="3" oninput="handlePinInput(this, 3)"></div><div id="pin-error" class="form-error" style="display:none;"></div></div><div style="display: flex; gap: 15px; margin-top: 30px;"><button class="btn-back" onclick="goToScreen('welcome')">‚Üê Voltar</button><button class="btn btn-primary" style="flex:1;" onclick="submitRegistration()">üöÄ Criar Conta</button></div></div></div>`;
        }

        function renderLogin() {
            if (state.profiles.length === 0) return `<div class="screen active"><div class="form-container glass" style="text-align: center;"><h2 class="form-title">Nenhuma Conta</h2><p class="form-subtitle">Ainda n√£o tens uma conta. Cria uma agora!</p><div style="margin-top: 30px;"><button class="btn btn-primary" onclick="goToScreen('register')">üöÄ Criar Conta</button></div><div style="margin-top: 15px;"><button class="btn-back" onclick="goToScreen('welcome')">‚Üê Voltar</button></div></div></div>`;
            return `<div class="screen active"><div class="form-container glass" style="max-width: 800px;"><h2 class="form-title">Escolhe o teu Perfil</h2><p class="form-subtitle">Clica no teu avatar para entrar</p><div class="profiles-grid">${state.profiles.map(p => { const avatar = getAvatar(p.avatar); return `<div class="profile-card glass" onclick="selectProfile('${p.id}')"><div class="profile-avatar">${avatar.emoji}</div><div class="profile-name">${p.name}</div><div class="profile-age">${p.age} anos</div></div>`; }).join('')}<div class="profile-card glass add-profile" onclick="goToScreen('register')"><div class="add-profile-icon">‚ûï</div><div class="profile-name">Nova Conta</div></div></div><div style="margin-top: 30px; text-align: center;"><button class="btn-back" onclick="goToScreen('welcome')">‚Üê Voltar</button></div></div></div>`;
        }

        function renderPinEntry() {
            const profile = state.selectedProfile;
            const avatar = getAvatar(profile.avatar);
            return `<div class="screen active"><div class="pin-entry-avatar">${avatar.emoji}</div><div class="pin-entry-name">${profile.name}</div><div class="pin-display"><div class="pin-dot" id="dot-0"></div><div class="pin-dot" id="dot-1"></div><div class="pin-dot" id="dot-2"></div><div class="pin-dot" id="dot-3"></div></div><div id="pin-entry-error" class="form-error" style="text-align: center; margin-bottom: 20px;"></div><div class="pin-keyboard">${[1,2,3,4,5,6,7,8,9].map(n => `<button class="pin-key glass" onclick="enterPinDigit('${n}')">${n}</button>`).join('')}<button class="pin-key glass" onclick="goToScreen('login')">‚Üê</button><button class="pin-key glass" onclick="enterPinDigit('0')">0</button><button class="pin-key glass" onclick="deletePinDigit()">‚å´</button></div></div>`;
        }

        function renderDashboard() {
            const profile = state.currentProfile;
            const avatar = getAvatar(profile.avatar);
            const plant = getPlantStage(profile.stats.lessonsCompleted);
            const level = calculateLevel(profile.stats.xp);
            const xpProgress = (profile.stats.xp % 100);
            const challengesUnlocked = profile.stats.lessonsCompleted >= 5;
            return `<div class="dashboard"><div class="sidebar"><div class="sidebar-profile"><div class="sidebar-avatar">${avatar.emoji}</div><div class="sidebar-name">${profile.name}</div><div class="sidebar-level">${profile.age} anos ‚Ä¢ N√≠vel ${level}</div></div><div class="sidebar-stats"><div class="stat-item"><div class="stat-icon">ü™ô</div><div class="stat-value">${profile.stats.coins}</div><div class="stat-label">Moedas</div></div><div class="stat-item"><div class="stat-icon">‚ö°</div><div class="stat-value">${profile.stats.xp}</div><div class="stat-label">XP</div></div><div class="stat-item"><div class="stat-icon">üìö</div><div class="stat-value">${profile.stats.lessonsCompleted}</div><div class="stat-label">Li√ß√µes</div></div><div class="stat-item"><div class="stat-icon">üèÜ</div><div class="stat-value">${profile.progress.challenges.length}</div><div class="stat-label">Desafios</div></div></div><div class="xp-bar"><div class="xp-bar-label"><span>XP</span><span>${xpProgress}/100</span></div><div class="xp-bar-track"><div class="xp-bar-fill" style="width: ${xpProgress}%"></div></div></div><div class="sidebar-nav"><div class="nav-item ${state.activeTab === 'dashboard' ? 'active' : ''}" onclick="setActiveTab('dashboard')"><span class="nav-icon">üè†</span><span>In√≠cio</span></div><div class="nav-item ${state.activeTab === 'lessons' ? 'active' : ''}" onclick="setActiveTab('lessons')"><span class="nav-icon">üìö</span><span>Li√ß√µes</span><span class="nav-badge">${ALL_LESSONS.length}</span></div><div class="nav-item ${state.activeTab === 'challenges' ? 'active' : ''} ${!challengesUnlocked ? 'locked' : ''}" onclick="${challengesUnlocked ? "setActiveTab('challenges')" : ''}"><span class="nav-icon">${challengesUnlocked ? 'üèÜ' : 'üîí'}</span><span>Desafios</span></div><div class="nav-item ${state.activeTab === 'tasks' ? 'active' : ''}" onclick="setActiveTab('tasks')"><span class="nav-icon">‚úÖ</span><span>Tarefas</span></div></div><div class="sidebar-logout"><button class="logout-btn" onclick="logout()">üö™ Sair</button></div></div><div class="main-content">${renderMainContent()}</div></div>${renderFooter()}`;
        }

        function renderMainContent() {
            const profile = state.currentProfile;
            const plant = getPlantStage(profile.stats.lessonsCompleted);
            const challengesUnlocked = profile.stats.lessonsCompleted >= 5;
            switch (state.activeTab) {
                case 'dashboard':
                    return `<div class="content-header"><h1 class="content-title">Ol√°, ${profile.name}! üëã</h1><p class="content-subtitle">Pronto para aprender hoje?</p></div><div class="plant-widget glass"><div class="plant-emoji">${plant.emoji}</div><div class="plant-name">Planta do Conhecimento</div><div class="plant-stage">${plant.name}</div></div><div class="lessons-section"><div class="section-header"><h2 class="section-title">üìö Li√ß√µes Recomendadas</h2></div><div class="lessons-grid">${ALL_LESSONS.slice(0, 6).map(lesson => renderLessonCard(lesson)).join('')}</div></div>${!challengesUnlocked ? `<div class="unlock-message glass"><div style="font-size: 3rem; margin-bottom: 15px;">üîí</div><h3>Desafios Bloqueados</h3><p>Completa 5 li√ß√µes para desbloquear os desafios semanais!</p><div class="unlock-progress"><span>${profile.stats.lessonsCompleted}/5 li√ß√µes</span><div class="unlock-bar"><div class="unlock-fill" style="width: ${(profile.stats.lessonsCompleted / 5) * 100}%"></div></div></div></div>` : ''}`;
                case 'lessons':
                    const filteredLessons = state.lessonFilter === 'all' ? ALL_LESSONS : ALL_LESSONS.filter(l => { if (state.lessonFilter === 'financial') return l.category === 'Literacia Financeira'; if (state.lessonFilter === 'social') return l.category === 'Conviv√™ncia'; if (state.lessonFilter === 'portuguese') return l.category === 'Portugu√™s'; if (state.lessonFilter === 'math') return l.category === 'Matem√°tica'; if (state.lessonFilter === 'science') return l.category === 'Ci√™ncias'; return true; });
                    return `<div class="content-header"><h1 class="content-title">üìö Todas as Li√ß√µes</h1><p class="content-subtitle">${ALL_LESSONS.length} li√ß√µes dispon√≠veis</p></div><div class="filter-tabs" style="margin-bottom: 25px;"><button class="filter-tab ${state.lessonFilter === 'all' ? 'active' : ''}" onclick="setLessonFilter('all')">Todas</button><button class="filter-tab ${state.lessonFilter === 'financial' ? 'active' : ''}" onclick="setLessonFilter('financial')">üí∞ Finan√ßas</button><button class="filter-tab ${state.lessonFilter === 'social' ? 'active' : ''}" onclick="setLessonFilter('social')">ü§ù Conviv√™ncia</button><button class="filter-tab ${state.lessonFilter === 'portuguese' ? 'active' : ''}" onclick="setLessonFilter('portuguese')">üìù Portugu√™s</button><button class="filter-tab ${state.lessonFilter === 'math' ? 'active' : ''}" onclick="setLessonFilter('math')">üî¢ Matem√°tica</button><button class="filter-tab ${state.lessonFilter === 'science' ? 'active' : ''}" onclick="setLessonFilter('science')">üî¨ Ci√™ncias</button></div><div class="lessons-grid">${filteredLessons.map(lesson => renderLessonCard(lesson)).join('')}</div>`;
                case 'challenges':
                    return `<div class="content-header"><h1 class="content-title">üèÜ Desafios Semanais</h1><p class="content-subtitle">Completa desafios para ganhar recompensas especiais!</p></div><div class="challenges-grid">${CHALLENGES.map(ch => { const completed = profile.progress.challenges.includes(ch.id); return `<div class="challenge-card glass"><div class="challenge-checkbox ${completed ? 'checked' : ''}" onclick="toggleChallenge('${ch.id}')">${completed ? '‚úì' : ''}</div><div style="font-size: 2rem;">${ch.icon}</div><div class="challenge-info"><div class="challenge-title">${ch.title}</div><div class="challenge-desc">${ch.desc}</div></div><div class="challenge-reward">+${ch.reward} ü™ô</div></div>`; }).join('')}</div>`;
                case 'tasks':
                    return `<div class="content-header"><h1 class="content-title">‚úÖ Tarefas Dom√©sticas</h1><p class="content-subtitle">Ajuda em casa e ganha moedas!</p></div><div class="tasks-grid">${TASKS.map(task => { const completed = profile.progress.tasks.includes(task.id); return `<div class="task-card glass"><div class="task-checkbox ${completed ? 'checked' : ''}" onclick="toggleTask('${task.id}')">${completed ? '‚úì' : ''}</div><div style="font-size: 2rem;">${task.icon}</div><div class="task-info"><div class="task-title">${task.title}</div></div><div class="task-reward">+${task.reward} ü™ô</div></div>`; }).join('')}</div>`;
                default: return '';
            }
        }

        function renderLessonCard(lesson) {
            const completed = state.currentProfile.progress.lessons.includes(lesson.id);
            return `<div class="lesson-card glass ${completed ? 'completed' : ''}" onclick="startLesson('${lesson.id}')"><div class="lesson-badge">${completed ? '‚úÖ' : ''}</div><div class="lesson-icon">${lesson.icon}</div><div class="lesson-title">${lesson.title}</div><div class="lesson-category">${lesson.category}</div><div class="lesson-progress">${completed ? '‚úì Completa' : '3 perguntas'}</div></div>`;
        }

        function renderQuiz() {
            const lesson = state.currentLesson;
            const question = lesson.questions[state.currentQuestion];
            const progress = ((state.currentQuestion + 1) / lesson.questions.length) * 100;
            return `<div class="screen active" style="padding: 40px;"><div class="quiz-container glass"><div style="margin-bottom: 20px;"><button class="btn-back" onclick="exitQuiz()">‚Üê Voltar</button></div><div class="quiz-progress"><div class="quiz-progress-text"><span>${lesson.title}</span><span>Pergunta ${state.currentQuestion + 1} de ${lesson.questions.length}</span></div><div class="quiz-progress-bar"><div class="quiz-progress-fill" style="width: ${progress}%"></div></div></div><div class="quiz-question">${question.q}</div><div class="quiz-options" id="quiz-options">${question.options.map((opt, i) => `<div class="quiz-option" data-index="${i}" onclick="selectAnswer(${i})">${opt}</div>`).join('')}</div><div id="quiz-feedback"></div><div id="quiz-next"></div></div></div>`;
        }

        function renderCompletion() {
            const lesson = state.currentLesson;
            return `<div class="screen active"><div class="completion-screen glass"><div class="completion-emoji">üéâ</div><h1 class="completion-title">Li√ß√£o Completa!</h1><p style="font-size: 1.2rem; margin-bottom: 20px;">${lesson.title}</p><div class="completion-rewards"><div class="reward-item"><div class="reward-icon">ü™ô</div><div class="reward-value">+10</div></div><div class="reward-item"><div class="reward-icon">‚ö°</div><div class="reward-value">+20</div></div></div><button class="btn btn-primary" onclick="returnToDashboard()">üè† Voltar ao In√≠cio</button></div></div>`;
        }

        function renderFooter() {
            return `<footer class="app-footer"><div class="footer-logo">üåå GrowUp Kids</div><div class="footer-info"><p>Plataforma Educativa Interativa</p><p>Para crian√ßas dos 5 aos 13 anos</p></div><div class="footer-credits"><p><strong>Desenvolvido por Maria Samb√©</strong></p></div><div class="footer-copyright">¬© 2025 Maria Samb√© - Todos os direitos reservados</div><div class="footer-links"><a href="#" class="footer-link">Sobre</a><a href="#" class="footer-link">Contacto</a><a href="#" class="footer-link">Privacidade</a><a href="#" class="footer-link">Termos de Uso</a></div></footer>`;
        }

        function goToScreen(screen) { state.screen = screen; enteredPin = ''; render(); }
        function selectAvatar(avatarId) { selectedAvatarId = avatarId; document.querySelectorAll('.avatar-option').forEach(el => el.classList.remove('selected')); document.querySelector(`[data-avatar="${avatarId}"]`).classList.add('selected'); }
        function handlePinInput(input, index) { const value = input.value; if (!/^\d$/.test(value)) { input.value = ''; return; } if (index < 3) { const nextInput = document.querySelector(`[data-pin="${index + 1}"]`); if (nextInput) nextInput.focus(); } }

        function submitRegistration() {
            const name = document.getElementById('reg-name').value.trim();
            const age = document.getElementById('reg-age').value;
            const pinInputs = document.querySelectorAll('.pin-digit');
            const pin = Array.from(pinInputs).map(i => i.value).join('');
            let valid = true;
            if (!name || name.length < 2) { document.getElementById('name-error').textContent = 'Nome deve ter pelo menos 2 caracteres'; document.getElementById('name-error').style.display = 'block'; valid = false; } else { document.getElementById('name-error').style.display = 'none'; }
            if (!age) { document.getElementById('age-error').textContent = 'Seleciona a idade'; document.getElementById('age-error').style.display = 'block'; valid = false; } else { document.getElementById('age-error').style.display = 'none'; }
            if (!selectedAvatarId) { document.getElementById('avatar-error').textContent = 'Escolhe um avatar'; document.getElementById('avatar-error').style.display = 'block'; valid = false; } else { document.getElementById('avatar-error').style.display = 'none'; }
            if (pin.length !== 4) { document.getElementById('pin-error').textContent = 'PIN deve ter 4 d√≠gitos'; document.getElementById('pin-error').style.display = 'block'; valid = false; } else { document.getElementById('pin-error').style.display = 'none'; }
            if (!valid) return;
            const newProfile = { id: generateId(), name: name, age: parseInt(age), avatar: selectedAvatarId, pin: encryptPIN(pin), createdAt: new Date().toISOString(), stats: { coins: 0, xp: 0, lessonsCompleted: 0 }, progress: { lessons: [], challenges: [], tasks: [] } };
            state.profiles.push(newProfile);
            saveProfiles();
            state.currentProfile = newProfile;
            saveCurrentSession(newProfile.id);
            triggerConfetti();
            state.screen = 'dashboard';
            state.activeTab = 'dashboard';
            render();
        }

        function selectProfile(profileId) { state.selectedProfile = state.profiles.find(p => p.id === profileId); state.screen = 'pinEntry'; enteredPin = ''; render(); }
        function enterPinDigit(digit) { if (enteredPin.length < 4) { enteredPin += digit; updatePinDisplay(); if (enteredPin.length === 4) setTimeout(verifyPin, 300); } }
        function deletePinDigit() { enteredPin = enteredPin.slice(0, -1); updatePinDisplay(); document.getElementById('pin-entry-error').textContent = ''; }
        function updatePinDisplay() { for (let i = 0; i < 4; i++) { const dot = document.getElementById(`dot-${i}`); if (i < enteredPin.length) dot.classList.add('filled'); else dot.classList.remove('filled'); } }
        function verifyPin() { const profile = state.selectedProfile; const storedPin = decryptPIN(profile.pin); if (enteredPin === storedPin) { state.currentProfile = profile; saveCurrentSession(profile.id); triggerConfetti(); state.screen = 'dashboard'; state.activeTab = 'dashboard'; render(); } else { document.getElementById('pin-entry-error').textContent = 'PIN incorreto!'; enteredPin = ''; updatePinDisplay(); } }
        function logout() { clearSession(); state.currentProfile = null; state.screen = 'welcome'; render(); }
        function setActiveTab(tab) { const challengesUnlocked = state.currentProfile.stats.lessonsCompleted >= 5; if (tab === 'challenges' && !challengesUnlocked) return; state.activeTab = tab; render(); }
        function setLessonFilter(filter) { state.lessonFilter = filter; render(); }
        function startLesson(lessonId) { state.currentLesson = ALL_LESSONS.find(l => l.id === lessonId); state.currentQuestion = 0; state.quizScore = 0; state.screen = 'quiz'; render(); }

        function selectAnswer(index) {
            const question = state.currentLesson.questions[state.currentQuestion];
            const options = document.querySelectorAll('.quiz-option');
            options.forEach(opt => { opt.style.pointerEvents = 'none'; const optIndex = parseInt(opt.dataset.index); if (optIndex === question.correct) opt.classList.add('correct'); else if (optIndex === index && index !== question.correct) opt.classList.add('incorrect'); });
            const isCorrect = index === question.correct;
            if (isCorrect) { state.quizScore++; triggerConfetti(); }
            document.getElementById('quiz-feedback').innerHTML = `<div class="quiz-feedback ${isCorrect ? 'correct' : 'incorrect'}">${isCorrect ? 'üéâ Muito bem! Resposta correta!' : '‚ùå Resposta incorreta. A resposta certa era: ' + question.options[question.correct]}</div>`;
            const isLast = state.currentQuestion >= state.currentLesson.questions.length - 1;
            document.getElementById('quiz-next').innerHTML = `<button class="btn btn-primary quiz-next-btn" onclick="${isLast ? 'completeLesson()' : 'nextQuestion()'}">    ${isLast ? 'üèÜ Completar Li√ß√£o' : '‚û°Ô∏è Pr√≥xima Pergunta'}</button>`;
        }

        function nextQuestion() { state.currentQuestion++; render(); }

        function completeLesson() {
            const profile = state.currentProfile;
            const lesson = state.currentLesson;
            if (!profile.progress.lessons.includes(lesson.id)) { profile.progress.lessons.push(lesson.id); profile.stats.lessonsCompleted++; profile.stats.coins += 10; profile.stats.xp += 20; const index = state.profiles.findIndex(p => p.id === profile.id); state.profiles[index] = profile; saveProfiles(); }
            triggerConfetti();
            setTimeout(() => triggerConfetti(), 500);
            state.screen = 'completion';
            render();
        }

        function exitQuiz() { state.screen = 'dashboard'; render(); }
        function returnToDashboard() { state.screen = 'dashboard'; state.activeTab = 'dashboard'; render(); }

        function toggleChallenge(challengeId) {
            const profile = state.currentProfile;
            const challenge = CHALLENGES.find(c => c.id === challengeId);
            if (profile.progress.challenges.includes(challengeId)) { profile.progress.challenges = profile.progress.challenges.filter(id => id !== challengeId); profile.stats.coins -= challenge.reward; }
            else { profile.progress.challenges.push(challengeId); profile.stats.coins += challenge.reward; triggerConfetti(); }
            const index = state.profiles.findIndex(p => p.id === profile.id);
            state.profiles[index] = profile;
            saveProfiles();
            render();
        }

        function toggleTask(taskId) {
            const profile = state.currentProfile;
            const task = TASKS.find(t => t.id === taskId);
            if (profile.progress.tasks.includes(taskId)) { profile.progress.tasks = profile.progress.tasks.filter(id => id !== taskId); profile.stats.coins -= task.reward; }
            else { profile.progress.tasks.push(taskId); profile.stats.coins += task.reward; triggerConfetti(); }
            const index = state.profiles.findIndex(p => p.id === profile.id);
            state.profiles[index] = profile;
            saveProfiles();
            render();
        }

        function initParticles() {
            const canvas = document.getElementById('particles-canvas');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            camera.position.z = 5;
            const particlesGeometry = new THREE.BufferGeometry();
            const particlesCount = 5000;
            const posArray = new Float32Array(particlesCount * 3);
            const colorsArray = new Float32Array(particlesCount * 3);
            const colors = [[1, 0.42, 0.62], [0.75, 0.42, 0.97], [0.31, 0.8, 0.77], [0.97, 0.59, 0.12]];
            for (let i = 0; i < particlesCount * 3; i += 3) { posArray[i] = (Math.random() - 0.5) * 15; posArray[i + 1] = (Math.random() - 0.5) * 15; posArray[i + 2] = (Math.random() - 0.5) * 15; const color = colors[Math.floor(Math.random() * colors.length)]; colorsArray[i] = color[0]; colorsArray[i + 1] = color[1]; colorsArray[i + 2] = color[2]; }
            particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            particlesGeometry.setAttribute('color', new THREE.BufferAttribute(colorsArray, 3));
            const particlesMaterial = new THREE.PointsMaterial({ size: 0.04, vertexColors: true, transparent: true, opacity: 0.7, blending: THREE.AdditiveBlending });
            const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
            scene.add(particlesMesh);
            let time = 0;
            function animate() { requestAnimationFrame(animate); time += 0.001; particlesMesh.rotation.y = time * 0.15; particlesMesh.rotation.x = time * 0.08; renderer.render(scene, camera); }
            animate();
            window.addEventListener('resize', () => { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });
        }

        function init() {
            loadProfiles();
            const sessionId = loadCurrentSession();
            if (sessionId) { const profile = state.profiles.find(p => p.id === sessionId); if (profile) { state.currentProfile = profile; state.screen = 'dashboard'; } }
            initParticles();
            setTimeout(() => { document.getElementById('loading-screen').classList.add('hidden'); render(); }, 2000);
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
