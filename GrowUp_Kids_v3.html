<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GrowUp Kids - Plataforma Educativa</title>
    
    <!-- External Libraries -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        /* Reset e Base - Feito com carinho por Maria Samb√© */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
            background: #0a0a1a;
            color: #ffffff;
        }

        /* Canvas 3D Background */
        #three-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        #root {
            position: relative;
            z-index: 1;
            min-height: 100vh;
        }

        /* Glassmorphism Ultra */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(30px) saturate(200%);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 8px 32px 0 rgba(31, 38, 135, 0.37),
                inset 0 0 20px rgba(255, 255, 255, 0.05);
        }

        .glass-strong {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(40px) saturate(250%);
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, #1a1a3e 0%, #0a0a1a 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #ff6b9d;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            font-size: 1.2rem;
            color: #fff;
            text-shadow: 0 0 20px rgba(255, 107, 157, 0.5);
        }

        /* Welcome Screen */
        .welcome-screen {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .welcome-logo {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        .welcome-title {
            font-size: 3rem;
            font-weight: bold;
            background: linear-gradient(45deg, #ff6b9d, #c06bf8, #4ecdc4, #44a08d, #f7971e, #ffd200);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient 5s ease infinite;
            margin-bottom: 10px;
            text-shadow: 0 0 40px rgba(255, 107, 157, 0.5);
        }

        @keyframes gradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .welcome-subtitle {
            font-size: 1.3rem;
            color: #aaa;
            margin-bottom: 50px;
            text-align: center;
        }

        .welcome-buttons {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn-primary {
            padding: 20px 50px;
            font-size: 1.3rem;
            font-weight: bold;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .btn-register {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .btn-register:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6);
        }

        .btn-login {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            box-shadow: 0 10px 30px rgba(240, 147, 251, 0.4);
        }

        .btn-login:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 40px rgba(240, 147, 251, 0.6);
        }

        /* Registration Form */
        .registration-screen, .login-screen {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .form-container {
            max-width: 600px;
            width: 100%;
            padding: 40px;
        }

        .form-title {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-align: center;
            background: linear-gradient(45deg, #ff6b9d, #c06bf8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .form-subtitle {
            text-align: center;
            color: #aaa;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #fff;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #ff6b9d;
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 20px rgba(255, 107, 157, 0.3);
        }

        .form-select {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            cursor: pointer;
        }

        .avatar-selection {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 10px;
        }

        .avatar-option {
            padding: 20px;
            text-align: center;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }

        .avatar-option:hover {
            transform: scale(1.05);
            border-color: rgba(255, 107, 157, 0.5);
        }

        .avatar-option.selected {
            border-color: #ff6b9d;
            background: rgba(255, 107, 157, 0.2);
            box-shadow: 0 0 30px rgba(255, 107, 157, 0.5);
        }

        .avatar-emoji {
            font-size: 3rem;
            margin-bottom: 5px;
        }

        .avatar-name {
            font-size: 0.9rem;
            color: #fff;
        }

        .pin-input-container {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }

        .pin-digit {
            width: 60px;
            height: 60px;
            font-size: 2rem;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }

        .pin-digit:focus {
            outline: none;
            border-color: #ff6b9d;
            box-shadow: 0 0 20px rgba(255, 107, 157, 0.5);
        }

        .form-error {
            color: #ff6b9d;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .form-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn-submit {
            flex: 1;
            padding: 18px;
            font-size: 1.2rem;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transition: all 0.3s;
        }

        .btn-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5);
        }

        .btn-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-back {
            padding: 18px 30px;
            font-size: 1.1rem;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            background: transparent;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-back:hover {
            border-color: #ff6b9d;
            background: rgba(255, 107, 157, 0.1);
        }

        /* Profile Selection (Login) */
        .profiles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .profile-card {
            padding: 30px;
            text-align: center;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }

        .profile-card:hover {
            transform: translateY(-10px) scale(1.05);
            border-color: #ff6b9d;
            box-shadow: 0 20px 40px rgba(255, 107, 157, 0.4);
        }

        .profile-avatar {
            font-size: 4rem;
            margin-bottom: 10px;
        }

        .profile-name {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .profile-age {
            font-size: 0.9rem;
            color: #aaa;
        }

        .add-profile-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 3px dashed rgba(255, 255, 255, 0.3);
        }

        .add-profile-icon {
            font-size: 4rem;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        /* PIN Entry Screen */
        .pin-entry-screen {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .pin-entry-avatar {
            font-size: 5rem;
            margin-bottom: 20px;
        }

        .pin-entry-name {
            font-size: 2rem;
            margin-bottom: 40px;
        }

        .pin-keyboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            max-width: 300px;
            margin: 30px auto;
        }

        .pin-key {
            width: 80px;
            height: 80px;
            font-size: 2rem;
            font-weight: bold;
            border: none;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pin-key:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .pin-key:active {
            transform: scale(0.95);
        }

        .pin-display {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .pin-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s;
        }

        .pin-dot.filled {
            background: #ff6b9d;
            border-color: #ff6b9d;
            box-shadow: 0 0 20px rgba(255, 107, 157, 0.8);
        }

        /* Footer - Cr√©ditos de Maria Samb√© */
        .app-footer {
            padding: 40px 20px;
            text-align: center;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 60px;
        }

        .footer-logo {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .footer-info {
            font-size: 0.9rem;
            color: #aaa;
            margin-bottom: 20px;
        }

        .footer-credits {
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .footer-credits strong {
            color: #ff6b9d;
            font-size: 1.2rem;
        }

        .footer-copyright {
            font-size: 0.9rem;
            color: #888;
        }

        .footer-links {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .footer-link {
            color: #aaa;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-link:hover {
            color: #ff6b9d;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .welcome-title {
                font-size: 2rem;
            }
            
            .avatar-selection {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .profiles-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <canvas id="three-canvas"></canvas>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        const { useState, useEffect, useRef } = React;

        // ==========================================
        // DADOS E CONFIGURA√á√ïES
        // ==========================================

        const AVATARS = [
            { id: 'sofia', emoji: 'üëßüéÄ', name: 'Sofia G√©nio', gender: 'female' },
            { id: 'luna', emoji: 'üëßüåô', name: 'Luna S√°bia', gender: 'female' },
            { id: 'iris', emoji: 'üëßüëì', name: 'Iris Inteligente', gender: 'female' },
            { id: 'pedro', emoji: 'üë¶üé©', name: 'Pedro S√°bio', gender: 'male' },
            { id: 'marco', emoji: 'üë¶‚≠ê', name: 'Marco Esperto', gender: 'male' },
            { id: 'tomas', emoji: 'üë¶üí°', name: 'Tom√°s Brilhante', gender: 'male' }
        ];

        // ==========================================
        // UTILIDADES
        // ==========================================

        // Encripta√ß√£o simples de PIN (em produ√ß√£o usar bcrypt ou similar)
        const encryptPIN = (pin) => {
            return btoa(pin); // Base64 encoding
        };

        const decryptPIN = (encrypted) => {
            try {
                return atob(encrypted);
            } catch {
                return null;
            }
        };

        // Gerar UUID simples
        const generateUUID = () => {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        };

        // ==========================================
        // GEST√ÉO DE PERFIS (LocalStorage)
        // ==========================================

        const ProfileManager = {
            getProfiles: () => {
                const data = localStorage.getItem('growupkids_profiles');
                return data ? JSON.parse(data) : [];
            },

            saveProfiles: (profiles) => {
                localStorage.setItem('growupkids_profiles', JSON.stringify(profiles));
            },

            addProfile: (profile) => {
                const profiles = ProfileManager.getProfiles();
                const newProfile = {
                    id: generateUUID(),
                    ...profile,
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString(),
                    stats: {
                        coins: 0,
                        xp: 0,
                        level: 1,
                        lessonsCompleted: 0,
                        challengesUnlocked: false,
                        tasksCompleted: 0
                    },
                    progress: {
                        lessons: [],
                        challenges: [],
                        tasks: [],
                        schoolLessons: []
                    }
                };
                profiles.push(newProfile);
                ProfileManager.saveProfiles(profiles);
                return newProfile;
            },

            updateProfile: (profileId, updates) => {
                const profiles = ProfileManager.getProfiles();
                const index = profiles.findIndex(p => p.id === profileId);
                if (index !== -1) {
                    profiles[index] = { ...profiles[index], ...updates };
                    ProfileManager.saveProfiles(profiles);
                    return profiles[index];
                }
                return null;
            },

            getCurrentProfile: () => {
                const profileId = localStorage.getItem('growupkids_current_profile');
                if (!profileId) return null;
                const profiles = ProfileManager.getProfiles();
                return profiles.find(p => p.id === profileId) || null;
            },

            setCurrentProfile: (profileId) => {
                localStorage.setItem('growupkids_current_profile', profileId);
            },

            clearCurrentProfile: () => {
                localStorage.removeItem('growupkids_current_profile');
            },

            verifyPIN: (profileId, pin) => {
                const profiles = ProfileManager.getProfiles();
                const profile = profiles.find(p => p.id === profileId);
                if (!profile) return false;
                return decryptPIN(profile.pin) === pin;
            }
        };

        // ==========================================
        // COMPONENTES
        // ==========================================

        // Loading Screen
        function LoadingScreen() {
            return (
                <div className="loading-screen">
                    <div className="loading-spinner"></div>
                    <div className="loading-text">‚ú® Preparando experi√™ncia c√≥smica...</div>
                </div>
            );
        }

        // Welcome Screen
        function WelcomeScreen({ onRegister, onLogin }) {
            return (
                <div className="welcome-screen">
                    <div className="welcome-logo">üåå</div>
                    <h1 className="welcome-title">GrowUp Kids</h1>
                    <p className="welcome-subtitle">
                        Plataforma Educativa Interativa<br/>
                        Para crian√ßas dos 5 aos 13 anos
                    </p>
                    <div className="welcome-buttons">
                        <button className="btn-primary btn-register" onClick={onRegister}>
                            üöÄ Criar Conta
                        </button>
                        <button className="btn-primary btn-login" onClick={onLogin}>
                            üîë J√° tenho conta
                        </button>
                    </div>
                </div>
            );
        }

        // Registration Screen
        function RegistrationScreen({ onBack, onComplete }) {
            const [formData, setFormData] = useState({
                name: '',
                age: '',
                avatar: '',
                pin: '',
                pinConfirm: ''
            });
            const [errors, setErrors] = useState({});
            const [step, setStep] = useState(1); // 1: dados b√°sicos, 2: avatar, 3: PIN

            const pinRefs = [useRef(), useRef(), useRef(), useRef()];
            const pinConfirmRefs = [useRef(), useRef(), useRef(), useRef()];

            const validateStep1 = () => {
                const newErrors = {};
                if (!formData.name || formData.name.length < 2) {
                    newErrors.name = 'Nome deve ter pelo menos 2 caracteres';
                }
                if (!formData.age) {
                    newErrors.age = 'Por favor, seleciona a idade';
                }
                setErrors(newErrors);
                return Object.keys(newErrors).length === 0;
            };

            const validateStep2 = () => {
                if (!formData.avatar) {
                    setErrors({ avatar: 'Por favor, escolhe um avatar' });
                    return false;
                }
                setErrors({});
                return true;
            };

            const validateStep3 = () => {
                const newErrors = {};
                if (formData.pin.length !== 4) {
                    newErrors.pin = 'PIN deve ter 4 d√≠gitos';
                }
                if (formData.pin !== formData.pinConfirm) {
                    newErrors.pinConfirm = 'PINs n√£o coincidem';
                }
                setErrors(newErrors);
                return Object.keys(newErrors).length === 0;
            };

            const handleNext = () => {
                if (step === 1 && validateStep1()) {
                    setStep(2);
                } else if (step === 2 && validateStep2()) {
                    setStep(3);
                }
            };

            const handleSubmit = () => {
                if (validateStep3()) {
                    const profile = ProfileManager.addProfile({
                        name: formData.name,
                        age: parseInt(formData.age),
                        avatar: formData.avatar,
                        pin: encryptPIN(formData.pin)
                    });
                    
                    confetti({
                        particleCount: 200,
                        spread: 100,
                        origin: { y: 0.6 }
                    });
                    
                    onComplete(profile);
                }
            };

            const handlePinInput = (index, value, refs) => {
                if (value.length === 1 && /^\d$/.test(value)) {
                    const newPin = formData[refs === pinRefs ? 'pin' : 'pinConfirm'].split('');
                    newPin[index] = value;
                    setFormData({
                        ...formData,
                        [refs === pinRefs ? 'pin' : 'pinConfirm']: newPin.join('')
                    });
                    
                    if (index < 3) {
                        refs[index + 1].current?.focus();
                    }
                }
            };

            return (
                <div className="registration-screen">
                    <div className="form-container glass">
                        <h2 className="form-title">Criar Nova Conta</h2>
                        <p className="form-subtitle">Passo {step} de 3</p>

                        {step === 1 && (
                            <>
                                <div className="form-group">
                                    <label className="form-label">Nome da Crian√ßa</label>
                                    <input
                                        type="text"
                                        className="form-input"
                                        placeholder="Ex: Sofia"
                                        value={formData.name}
                                        onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                                    />
                                    {errors.name && <div className="form-error">{errors.name}</div>}
                                </div>

                                <div className="form-group">
                                    <label className="form-label">Idade</label>
                                    <select
                                        className="form-select"
                                        value={formData.age}
                                        onChange={(e) => setFormData({ ...formData, age: e.target.value })}
                                    >
                                        <option value="">Seleciona a idade</option>
                                        {[5, 6, 7, 8, 9, 10, 11, 12, 13].map(age => (
                                            <option key={age} value={age}>{age} anos</option>
                                        ))}
                                    </select>
                                    {errors.age && <div className="form-error">{errors.age}</div>}
                                </div>
                            </>
                        )}

                        {step === 2 && (
                            <div className="form-group">
                                <label className="form-label">Escolhe o teu Avatar</label>
                                <div className="avatar-selection">
                                    {AVATARS.map(avatar => (
                                        <div
                                            key={avatar.id}
                                            className={`avatar-option glass ${formData.avatar === avatar.id ? 'selected' : ''}`}
                                            onClick={() => setFormData({ ...formData, avatar: avatar.id })}
                                        >
                                            <div className="avatar-emoji">{avatar.emoji}</div>
                                            <div className="avatar-name">{avatar.name}</div>
                                        </div>
                                    ))}
                                </div>
                                {errors.avatar && <div className="form-error">{errors.avatar}</div>}
                            </div>
                        )}

                        {step === 3 && (
                            <>
                                <div className="form-group">
                                    <label className="form-label">Cria um PIN de 4 d√≠gitos</label>
                                    <div className="pin-input-container">
                                        {[0, 1, 2, 3].map(i => (
                                            <input
                                                key={i}
                                                ref={pinRefs[i]}
                                                type="password"
                                                maxLength="1"
                                                className="pin-digit"
                                                onChange={(e) => handlePinInput(i, e.target.value, pinRefs)}
                                            />
                                        ))}
                                    </div>
                                    {errors.pin && <div className="form-error">{errors.pin}</div>}
                                </div>

                                <div className="form-group">
                                    <label className="form-label">Confirma o PIN</label>
                                    <div className="pin-input-container">
                                        {[0, 1, 2, 3].map(i => (
                                            <input
                                                key={i}
                                                ref={pinConfirmRefs[i]}
                                                type="password"
                                                maxLength="1"
                                                className="pin-digit"
                                                onChange={(e) => handlePinInput(i, e.target.value, pinConfirmRefs)}
                                            />
                                        ))}
                                    </div>
                                    {errors.pinConfirm && <div className="form-error">{errors.pinConfirm}</div>}
                                </div>
                            </>
                        )}

                        <div className="form-buttons">
                            {step > 1 && (
                                <button className="btn-back" onClick={() => setStep(step - 1)}>
                                    ‚Üê Voltar
                                </button>
                            )}
                            {step === 1 && (
                                <button className="btn-back" onClick={onBack}>
                                    ‚Üê Voltar
                                </button>
                            )}
                            {step < 3 ? (
                                <button className="btn-submit" onClick={handleNext}>
                                    Pr√≥ximo ‚Üí
                                </button>
                            ) : (
                                <button className="btn-submit" onClick={handleSubmit}>
                                    üöÄ Criar Conta
                                </button>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // Login Screen - Profile Selection
        function LoginScreen({ onBack, onSelectProfile }) {
            const profiles = ProfileManager.getProfiles();

            return (
                <div className="login-screen">
                    <div className="form-container glass" style={{ maxWidth: '900px' }}>
                        <h2 className="form-title">Escolhe o teu Perfil</h2>
                        <p className="form-subtitle">Clica no teu avatar para entrar</p>

                        <div className="profiles-grid">
                            {profiles.map(profile => {
                                const avatar = AVATARS.find(a => a.id === profile.avatar);
                                return (
                                    <div
                                        key={profile.id}
                                        className="profile-card glass"
                                        onClick={() => onSelectProfile(profile)}
                                    >
                                        <div className="profile-avatar">{avatar?.emoji || 'üë§'}</div>
                                        <div className="profile-name">{profile.name}</div>
                                        <div className="profile-age">{profile.age} anos</div>
                                    </div>
                                );
                            })}
                            
                            <div className="profile-card add-profile-card glass" onClick={onBack}>
                                <div className="add-profile-icon">‚ûï</div>
                                <div className="profile-name">Nova Conta</div>
                            </div>
                        </div>

                        <div className="form-buttons" style={{ marginTop: '30px' }}>
                            <button className="btn-back" onClick={onBack}>
                                ‚Üê Voltar
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // PIN Entry Screen
        function PINEntryScreen({ profile, onSuccess, onBack }) {
            const [pin, setPin] = useState('');
            const [error, setError] = useState('');
            const [attempts, setAttempts] = useState(0);
            const avatar = AVATARS.find(a => a.id === profile.avatar);

            const handleKeyPress = (digit) => {
                if (pin.length < 4) {
                    const newPin = pin + digit;
                    setPin(newPin);
                    
                    if (newPin.length === 4) {
                        setTimeout(() => verifyPin(newPin), 300);
                    }
                }
            };

            const handleDelete = () => {
                setPin(pin.slice(0, -1));
                setError('');
            };

            const verifyPin = (enteredPin) => {
                if (ProfileManager.verifyPIN(profile.id, enteredPin)) {
                    ProfileManager.setCurrentProfile(profile.id);
                    ProfileManager.updateProfile(profile.id, {
                        lastLogin: new Date().toISOString()
                    });
                    
                    confetti({
                        particleCount: 150,
                        spread: 80,
                        origin: { y: 0.6 }
                    });
                    
                    onSuccess(profile);
                } else {
                    setError('PIN incorreto!');
                    setPin('');
                    setAttempts(attempts + 1);
                    
                    if (attempts >= 2) {
                        setError('Muitas tentativas! Tenta mais tarde.');
                        setTimeout(() => onBack(), 2000);
                    }
                }
            };

            return (
                <div className="pin-entry-screen">
                    <div className="pin-entry-avatar">{avatar?.emoji || 'üë§'}</div>
                    <div className="pin-entry-name">{profile.name}</div>
                    
                    <div className="pin-display">
                        {[0, 1, 2, 3].map(i => (
                            <div key={i} className={`pin-dot ${pin.length > i ? 'filled' : ''}`} />
                        ))}
                    </div>
                    
                    {error && <div className="form-error" style={{ marginBottom: '20px' }}>{error}</div>}
                    
                    <div className="pin-keyboard">
                        {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(num => (
                            <button key={num} className="pin-key glass" onClick={() => handleKeyPress(num.toString())}>
                                {num}
                            </button>
                        ))}
                        <button className="pin-key glass" onClick={onBack}>‚Üê</button>
                        <button className="pin-key glass" onClick={() => handleKeyPress('0')}>0</button>
                        <button className="pin-key glass" onClick={handleDelete}>‚å´</button>
                    </div>
                </div>
            );
        }

        // Main Dashboard (Placeholder - ser√° expandido)
        function Dashboard({ profile, onLogout }) {
            const avatar = AVATARS.find(a => a.id === profile.avatar);
            
            return (
                <div style={{ padding: '40px', minHeight: '100vh' }}>
                    <div className="glass" style={{ padding: '40px', maxWidth: '800px', margin: '0 auto' }}>
                        <div style={{ textAlign: 'center' }}>
                            <div style={{ fontSize: '5rem' }}>{avatar?.emoji}</div>
                            <h1 style={{ fontSize: '2.5rem', marginBottom: '10px' }}>
                                Bem-vindo(a), {profile.name}!
                            </h1>
                            <p style={{ color: '#aaa', marginBottom: '30px' }}>
                                {profile.age} anos ‚Ä¢ N√≠vel {profile.stats.level}
                            </p>
                            
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '20px', marginBottom: '30px' }}>
                                <div className="glass" style={{ padding: '20px' }}>
                                    <div style={{ fontSize: '2rem' }}>ü™ô</div>
                                    <div style={{ fontSize: '1.5rem', fontWeight: 'bold' }}>{profile.stats.coins}</div>
                                    <div style={{ fontSize: '0.9rem', color: '#aaa' }}>Moedas</div>
                                </div>
                                <div className="glass" style={{ padding: '20px' }}>
                                    <div style={{ fontSize: '2rem' }}>‚ö°</div>
                                    <div style={{ fontSize: '1.5rem', fontWeight: 'bold' }}>{profile.stats.xp}</div>
                                    <div style={{ fontSize: '0.9rem', color: '#aaa' }}>XP</div>
                                </div>
                                <div className="glass" style={{ padding: '20px' }}>
                                    <div style={{ fontSize: '2rem' }}>üìö</div>
                                    <div style={{ fontSize: '1.5rem', fontWeight: 'bold' }}>{profile.stats.lessonsCompleted}</div>
                                    <div style={{ fontSize: '0.9rem', color: '#aaa' }}>Li√ß√µes</div>
                                </div>
                            </div>
                            
                            <p style={{ fontSize: '1.2rem', marginBottom: '20px' }}>
                                üöÄ Dashboard completo em desenvolvimento...<br/>
                                Em breve ter√°s acesso a todas as funcionalidades!
                            </p>
                            
                            <button className="btn-submit" onClick={onLogout} style={{ marginTop: '20px' }}>
                                üö™ Sair
                            </button>
                        </div>
                    </div>
                    
                    {/* Footer */}
                    <footer className="app-footer">
                        <div className="footer-logo">üåå GrowUp Kids</div>
                        <div className="footer-info">
                            <p>Plataforma Educativa Interativa</p>
                            <p>Para crian√ßas dos 5 aos 13 anos</p>
                        </div>
                        <div className="footer-credits">
                            <p><strong>Desenvolvido por Maria Samb√©</strong></p>
                        </div>
                        <div className="footer-copyright">
                            ¬© 2025 Maria Samb√© - Todos os direitos reservados
                        </div>
                        <div className="footer-links">
                            <a href="#sobre" className="footer-link">Sobre</a>
                            <a href="#contacto" className="footer-link">Contacto</a>
                            <a href="#privacidade" className="footer-link">Privacidade</a>
                            <a href="#termos" className="footer-link">Termos de Uso</a>
                        </div>
                    </footer>
                </div>
            );
        }

        // ==========================================
        // APLICA√á√ÉO PRINCIPAL
        // ==========================================

        function App() {
            const [loading, setLoading] = useState(true);
            const [screen, setScreen] = useState('welcome'); // welcome, register, login, pinEntry, dashboard
            const [selectedProfile, setSelectedProfile] = useState(null);
            const [currentProfile, setCurrentProfile] = useState(null);

            useEffect(() => {
                // Verificar se j√° existe sess√£o ativa
                const profile = ProfileManager.getCurrentProfile();
                if (profile) {
                    setCurrentProfile(profile);
                    setScreen('dashboard');
                }
                
                // Simular loading
                setTimeout(() => setLoading(false), 2000);
            }, []);

            const handleRegisterComplete = (profile) => {
                ProfileManager.setCurrentProfile(profile.id);
                setCurrentProfile(profile);
                setScreen('dashboard');
            };

            const handleLoginSuccess = (profile) => {
                setCurrentProfile(profile);
                setScreen('dashboard');
            };

            const handleLogout = () => {
                ProfileManager.clearCurrentProfile();
                setCurrentProfile(null);
                setScreen('welcome');
            };

            if (loading) {
                return <LoadingScreen />;
            }

            return (
                <>
                    {screen === 'welcome' && (
                        <WelcomeScreen
                            onRegister={() => setScreen('register')}
                            onLogin={() => setScreen('login')}
                        />
                    )}

                    {screen === 'register' && (
                        <RegistrationScreen
                            onBack={() => setScreen('welcome')}
                            onComplete={handleRegisterComplete}
                        />
                    )}

                    {screen === 'login' && (
                        <LoginScreen
                            onBack={() => setScreen('welcome')}
                            onSelectProfile={(profile) => {
                                setSelectedProfile(profile);
                                setScreen('pinEntry');
                            }}
                        />
                    )}

                    {screen === 'pinEntry' && selectedProfile && (
                        <PINEntryScreen
                            profile={selectedProfile}
                            onSuccess={handleLoginSuccess}
                            onBack={() => setScreen('login')}
                        />
                    )}

                    {screen === 'dashboard' && currentProfile && (
                        <Dashboard
                            profile={currentProfile}
                            onLogout={handleLogout}
                        />
                    )}
                </>
            );
        }

        // ==========================================
        // THREE.JS BACKGROUND
        // ==========================================

        function initThreeBackground() {
            const canvas = document.getElementById('three-canvas');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas, alpha: true });
            
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            
            camera.position.z = 5;

            // Criar part√≠culas
            const particlesGeometry = new THREE.BufferGeometry();
            const particlesCount = 8000;
            const posArray = new Float32Array(particlesCount * 3);
            const colorsArray = new Float32Array(particlesCount * 3);

            const colors = [
                [1, 0.42, 0.62], // Rosa
                [0.75, 0.42, 0.97], // Roxo
                [0.31, 0.8, 0.77], // Azul
                [0.27, 0.63, 0.55], // Verde
            ];

            for (let i = 0; i < particlesCount * 3; i += 3) {
                posArray[i] = (Math.random() - 0.5) * 20;
                posArray[i + 1] = (Math.random() - 0.5) * 20;
                posArray[i + 2] = (Math.random() - 0.5) * 20;

                const color = colors[Math.floor(Math.random() * colors.length)];
                colorsArray[i] = color[0];
                colorsArray[i + 1] = color[1];
                colorsArray[i + 2] = color[2];
            }

            particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            particlesGeometry.setAttribute('color', new THREE.BufferAttribute(colorsArray, 3));

            const particlesMaterial = new THREE.PointsMaterial({
                size: 0.05,
                vertexColors: true,
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending
            });

            const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
            scene.add(particlesMesh);

            // Anima√ß√£o
            let time = 0;
            function animate() {
                requestAnimationFrame(animate);
                time += 0.001;

                particlesMesh.rotation.y = time * 0.2;
                particlesMesh.rotation.x = time * 0.1;

                const positions = particlesGeometry.attributes.position.array;
                for (let i = 0; i < particlesCount; i++) {
                    const i3 = i * 3;
                    positions[i3 + 1] += Math.sin(time + positions[i3]) * 0.002;
                }
                particlesGeometry.attributes.position.needsUpdate = true;

                renderer.render(scene, camera);
            }

            animate();

            // Resize
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }

        // ==========================================
        // INICIALIZA√á√ÉO
        // ==========================================

        window.addEventListener('DOMContentLoaded', () => {
            initThreeBackground();
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<App />);
        });
    </script>

    <!-- Babel Standalone para JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</body>
</html>
